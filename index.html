<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
<head>
  <meta charset="utf-8">
  <script src="node_modules/socket.io/node_modules/socket.io-client/socket.io.js"></script>
  <!--<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>-->
  <script src="preload.js"></script>
  <script src="Carte.js"></script>
  <script src="Board.js"></script>
  <script src="gomassClt.js"></script>
  <script>
</script>
  <title>Gomass</title>
</head>
<body>
  <!-- need document.body -->
  <script src="gomassBoard.js"></script>
</body>
<script>
"use strict";
console.log('Start index.js');
//-----------------------------------------------------------
////////////////////////////////MAIN/////////////////////////
//-----------------------------------------------------------
//-----------------------------------------------------------
// BEGIN UI
var infoDiv = new gomassInfo(150, 250, 'info');
displayInfo(1, 'Fr');
// Up area
var userNameT = new gomassButton(650, 10, "text", '');
var userNameB = new gomassButton(800, 10, "button", "connect");
userNameB.onclick = function() {
  if (userNameT.value != '') {
    // init playerName
    playerName = userNameT.value;
    socket.emit('adduser', {
      name: playerName,
    });
    userNameB.disabled = true;
    userNameT.disabled = true;
    // change info
    displayInfo(2, 'Fr');
  }
}
var createT = new gomassButton(650, 40, "text", '');
var createB = new gomassButton(800, 40, "button", ".create.");
createB.onclick = function(game) {
  if (createT.value != '') {
    // init gameName
    gameName = createT.value;
    disableCommands(true);
    creator = true;
    socket.emit('newgame', {
      name: gameName,
      player: playerName
    });
    console.log('create game : ' + createT.value);
  }
}
var gomassListGame = new gomassCombo(650, 70, "gameList");
var joinB = new gomassButton(800, 70, "button", ".join.");
joinB.onclick = function(game) {
  if (gomassListGame.value != '') {
    disableCommands(true);
    creator = false;
    socket.emit('joingame', {
      name: gomassListGame.value,
      idx: gomassListGame.selectedIndex,
      player: playerName
    });
    console.log('join game : ' + gomassListGame.value);
  }
}
// Middle area
var endTurnB = new gomassButton(650, 570, "button", "end turn");
endTurnB.style.visibility = "hidden";
endTurnB.onclick = function() {
  socket.emit('endturn', {
    name: gameName,
    player: playerName,
    opponent: opponentName
  });
  endTurnB.disabled = true;
}
var finishSelectB = new gomassButton(450, 250, "button", "ok");
finishSelectB.style.visibility = "hidden";
finishSelectB.onclick = function() {
  socket.emit('removedhandcard', {
    player: playerName,
    iscreator: creator,
    myturn: myTurn,
    numbercard: cardSelector.numberOfCardAsked,
    room: gameName
  });
  console.log('ask for new cards');
}
var deckB = new gomassButton(650, 620, "button", ".deck.");
deckB.onclick = function() {
  // hide info
  infoDiv.visible(false);
  // show deck ui
  showDeckBuilder(true);
  hideCommands(true);
}
var finishDeckB = new gomassButton(300, 550, "button", "finish");
finishDeckB.style.visibility = "hidden";
finishDeckB.onclick = function() {
  // check if deck is complete
  if (!playerDeck.isComplete()) {
    playerDeck.fill(false);
  }
  // get all and change type img
  var myDeck = playerDeck.changeImgType('Normal');
  console.log(myDeck);
  // send deck to server
  socket.emit('deck', {
    player: playerName,
    deck: myDeck
  });
  // hide finish and clear buttons
  this.hide(true);
  clearB.hide(true);
  hideCommands(false);
}
var clearB = new gomassButton(360, 550, "button", ".clear.");
clearB.style.visibility = "hidden";
clearB.onclick = function() {
  playerDeck.clearAll();
  allCarte.unselectAll();
}
// Down area
var gomassChat = new gomassBox(20, 700, "chatArea");
var sendT = new gomassButton(20, 660, "text", "talk");
  sendT.size = 80;sendT.value = 'chat here !';
var sendB = new gomassButton(650, 660, "button", "send");
sendB.onclick = function() {
  socket.emit('newmessage', {
      message: sendT.value,
      player: playerName
    }
  );
}
// disable all buttons
disableCommands(true);
resetGameBoards();
//-----------------------------------------------------------
////////////////////////////////USEFULL//////////////////////
//-----------------------------------------------------------
function gomassButton(x, y, type, val) {
  var element = document.createElement("input");
  element.type = type;
  element.value = val;
  element.id = val;
  element.style.position = "absolute";
  element.style.left = x;
  element.style.top = y;
  element.disabled = false;
  element.hide = function(on) {
    this.disabled = on;
    if (on) {
      this.style.visibility = "hidden";
    }
    else {
      this.style.visibility = "visible";
    }
  };
  document.body.appendChild(element);
  return element;
}
function gomassBox(x, y, val) {
  var element = document.createElement("textarea");
  element.cols = 100;
  element.rows = 4;
  element.id = val;
  element.name = val;
  element.readonly = true;
  element.style.position = "absolute";
  element.style.left = x;
  element.style.top = y;
  element.disabled = false;
  element.hide = function(on) {
    this.disabled = on;
    if (on) {
      this.style.visibility = "hidden";
    }
    else {
      this.style.visibility = "visible";
    }
  };
  document.body.appendChild(element);
  return element;
}
function gomassInfo(x, y, id) {
  var element = document.createElement("div");
  element.id = id;
  element.readonly = true;
  element.style.position = "absolute";
  element.style.left = x;
  element.style.top = y;
  element.style.width = 500;
  element.style.height = 200;
  //element.style.border = "1px solid grey";
  element.disabled = false;
  element.setText = function(info) {
    this.innerHTML = info;
  };
  element.setButton = function() {
    var b = document.createElement("input");
    b.type = "button";
    b.value = ".end.";
    b.id = ".end."; 
    this.appendChild(b);
    b.onclick = function() {
      // create a new game
      loadNewGame();
      showGameBoards(false);
    };
  };
  element.visible = function(on) {
    this.disabled = on;
    if (on) {
      this.style.visibility = "visible";
    }
    else {
      this.style.visibility = "hidden";
    }
  };
  document.body.appendChild(element);
  return element;
}
function gomassCombo(x, y, val) {
  var element = document.createElement("select");
  element.id = val;
  element.name = val;
  element.readonly = true;
  element.style.position = "absolute";
  element.style.left = x;
  element.style.top = y;
  element.disabled = false;
  document.body.appendChild(element);
  element.addOpt = function(name) {
    var opt = document.createElement("option");
    opt.value = name;
    opt.text = name;
    opt.selected = true;
    this.add(opt);
  };
  element.hide = function(on) {
    this.disabled = on;
    if (on) {
      this.style.visibility = "hidden";
    }
    else {
      this.style.visibility = "visible";
    }
  };
  return element;
}
//-----------------------------------------------------------
function disableCommands(b) {
  createB.disabled = b;
  createT.disabled = b;
  joinB.disabled = b;
  gomassListGame.disabled = b;
  deckB.disabled = b;
}
function hideCommands(b) {
  createB.hide(b);
  createT.hide(b);
  joinB.hide(b);
  gomassListGame.hide(b);
  deckB.hide(b);
}
function loadNewGame() {
  // reset all
  gameName = 'DEFAULT';
  myTurn = false;
  creator = false;
  createT.value = '';
  endTurnB.hide(true);
  resetGameBoards();
  // choose a new avatar
  playerSelector.setVisibility(true);
  // change info
  displayInfo(2, 'Fr');
}
function displayInfo(num, lang) {
  var txt = '';
  if (lang = langage[0]) { // english
    switch (num) {
      case 1:
      txt = '<h2>1 - Connect to Gomass Game</h2>'+
      '<p>To begin, choose a name and click <b>connect</b> button.</p>';
      break;
      case 2:
      txt = '<h2>2 - Avatar selection</h2><p>Choose your Avatar : <ul>'+
      '<li>Invocus : Invocate a new creature 1/1 for 2 mana.</li>'+
      '<li>Spellus : Do 1 damage on creature or on player for 2 mana.</li>'+
      '<li>Healus : Add 1 life on creature or on player for 2 mana.</li>'+
      '<li>Armorus : Add 1 defense on creature or on player for 2 mana.</li>'+
      '</ul></p>';
      break;
      case 3:
      txt = '<h2>3 - Deck selection</h2><p>Choose your Deck : </p>'+
      '<p>Click <b>.deck.</b> button and choose your card.</p>'+
      '<p>Click <b>finish</b> button to complete selection.</p>';
      break;
      case 4:
      txt = '<h2>4 - Create or Join a game</h2>'+
      '<ul><li>Choose a game name and click <b>.create.</b> button.</li>'+
      '<li>Or select a game and click <b>.join.</b> button.</li>'+
      '<li>You can also modify your deck with <b>.deck.</b> button.</li>';
      break;
      case 5:
      txt = '<h2>5 - Wait until someone join the game.</h2>';
      break;
      case 6:
      txt = '<h2>6 - Choose your cards.</h2>';
      break;
      case 7:
      txt = '<h2>7 - Wait until player choose the cards.</h2>';
      break;
      case 8:
      txt = '<h2>8 - End of game</h2><p>You <b>win</b> the game : ' + gameName + ' you are the boss ' + playerName + '</p>';
      break;
      case 9:
      txt = '<h2>8 - End of game</h2><p>You <b>loose</b> the game : ' + gameName + ' may be next time ' + playerName + '</p>';
      break;
      default:
    }
  }
  if (lang = langage[1]) { // français
    switch (num) {
      case 1:
      txt = '<h2>1 - Connecte toi au jeu Gomass</h2>'+
      '<p>Choisi un nom et click sur le bouton <b>connect</b>.</p>';
      break;
      case 2:
      txt = "<h2>2 - Choisi ton avatar :</h2><p>Il existe 4 type d'avatar : <ul>"+
      '<li>Invocus : Il invoque une créature 1/1 pour 2 mana.</li>'+
      '<li>Spellus : Il retire 1 point de vie à une créature ou un joueur pour 2 mana.</li>'+
      '<li>Healus : Il ajoute 1 point de vie à une créature ou un joueur pour 2 mana.</li>'+
      "<li>Armorus : Il ajoute 1 point d'armure à une créature ou un joueur pour 2 mana.</li>"+
      '</ul></p>';
      break;
      case 3:
      txt = '<h2>3 - Compose ton deck </h2>'+
      '<p>Click sur le bouton <b>.deck.</b> et choisi tes cartes.</p>'+
      '<p>Click sur le bouton <b>finish</b> pour compléter la selection.</p>';
      break;
      case 4:
      txt = '<h2>4 - Créé ou rejoind une partie </h2>'+
      '<ul><li>Choisi le nom de ta partie puis click sur le bouton <b>.create.</b></li>'+
      '<li>Ou séletionne une partie et click sur le bouton <b>.join.</b></li>';
      break;
      case 5:
      txt = "<h2>5 - Attend jusqu'à ce que quelqu'un rejoingne la partie.</h2>";
      break;
      case 6:
      txt = '<h2>6 - Choisi les cartes de ta main.</h2>';
      break;
      case 7:
      txt = "<h2>7 - Attend jusqu'à ce que l'autre joueur ai choisi ses cartes.</h2>";
      break;
      case 8:
      txt = '<h2>8 - Fin du jeu</h2><p>Tu as <b>gagné</b> la partie : ' + gameName + " c'est toi le patron " + playerName + '</p>';
      break;
      case 9:
      txt = '<h2>8 - Fin du jeu</h2><p>Tu as <b>perdu</b> la partie : ' + gameName + ' essai encore ' + playerName + '</p>';
      break;
      default:
    }
  }
  infoDiv.setText(txt);
  infoDiv.visible(true);
}
console.log('Finish index.js');
//-----------------------------------------------------------
</script>
</html>
