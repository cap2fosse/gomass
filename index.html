<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
<head>
  <meta charset="utf-8">
  <script src="node_modules/socket.io/node_modules/socket.io-client/socket.io.js"></script>
  <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
  <script src="preload.js"></script>
  <script src="Carte.js"></script>
  <script src="Board.js"></script>
  <script src="gomassClt.js"></script>
  <script>
</script>
  <title>Gomass</title>
</head>
<body>
  <!-- need document.body -->
  <script src="gomassBoard.js"></script>
</body>
<script>
"use strict";
console.log('Start index.js');
//-----------------------------------------------------------
////////////////////////////////MAIN/////////////////////////
//-----------------------------------------------------------
//-----------------------------------------------------------
// BEGIN UI
// Up area
var userNameT = new gomassButton(850, 10, "text", '');
var userNameB = new gomassButton(1000, 10, "button", "connect");
userNameB.onclick = function() {
  if (userNameT.value != '') {
    // init playerName
    playerName = userNameT.value;
    socket.emit('adduser', {
      name: playerName,
    });
    userNameB.disabled = true;
    userNameT.disabled = true;
  }
}
var createT = new gomassButton(850, 50, "text", '');
var createB = new gomassButton(1000, 50, "button", ".create.");
createB.onclick = function(game) {
  if (createT.value != '') {
    // init gameName
    gameName = createT.value;
    disableCommands(true);
    creator = true;
    socket.emit('newgame', {
      name: gameName,
      player: playerName
    });
    console.log('create game : ' + createT.value);
  }
}
var gomassListGame = new gomassCombo(850, 90, "gameList");
var joinB = new gomassButton(1000, 90, "button", ".join.");
joinB.onclick = function(game) {
  if (gomassListGame.value != '') {
    disableCommands(true);
    creator = false;
    socket.emit('joingame', {
      name: gomassListGame.value,
      idx: gomassListGame.selectedIndex,
      player: playerName
    });
    console.log('join game : ' + gomassListGame.value);
  }
}
// Middle area
var endTurnB = new gomassButton(1000, 295, "button", "end turn");
endTurnB.style.visibility = "hidden";
endTurnB.onclick = function() {
    socket.emit('endturn', {
      name: gameName,
      player: playerName,
      opponent: opponentName
    });
    endTurnB.disabled = true;
}
var deckB = new gomassButton(1000, 355, "button", ".deck.");
deckB.onclick = function() {
  showDeckBuilder(true);
  disableCommands(true);
}
var finishDeckB = new gomassButton(1000, 395, "button", "finish");
finishDeckB.style.visibility = "hidden";
finishDeckB.onclick = function() {
  // check if deck is complete
  if (!playerDeck.isComplete()) {
    playerDeck.fill();
  }
  var myDeck = playerDeck.getAll();
  console.log(myDeck);
  // send deck to server
  socket.emit('deck', {
    player: playerName,
    deck: myDeck
  });
  this.hide(true);
}
// Down area
var gomassChat = new gomassBox(820, 500, "chatArea");
var sendT = new gomassButton(820, 580, "text", "talk");
  sendT.size = 20;sendT.value = '';
var sendB = new gomassButton(980, 580, "button", "send");
sendB.onclick = function() {
  socket.emit('newmessage', {
      message: sendT.value,
      player: playerName
    }
  );
}
// disable all buttons
disableCommands(true);
resetAllBoards();
//-----------------------------------------------------------
////////////////////////////////USEFULL//////////////////////
//-----------------------------------------------------------
function gomassButton(x, y, type, val) {
  var element = document.createElement("input");
  element.type = type;
  element.value = val;
  element.id = val;
  element.style.position = "absolute";
  element.style.left = x;
  element.style.top = y;
  element.disabled = false;
  element.hide = function(on) {
    this.disabled = on;
    if (on) {
      this.style.visibility = "hidden";
    }
    else {
      this.style.visibility = "visible";
    }
  };
  document.body.appendChild(element);
  return element;
}
function gomassBox(x, y, val) {
  var element = document.createElement("textarea");
  element.cols = 30;
  element.rows = 3;
  element.id = val;
  element.name = val;
  element.readonly = true;
  element.style.position = "absolute";
  element.style.left = x;
  element.style.top = y;
  element.disabled = false;
  document.body.appendChild(element);
  return element;
}
function gomassCombo(x, y, val) {
  var element = document.createElement("select");
  element.id = val;
  element.name = val;
  element.readonly = true;
  element.style.position = "absolute";
  element.style.left = x;
  element.style.top = y;
  element.disabled = false;
  document.body.appendChild(element);
  element.addOpt = function(name) {
    var opt = document.createElement("option");
    opt.value = name;
    opt.text = name;
    opt.selected = true;
    this.add(opt);
  };
  return element;
}
//-----------------------------------------------------------
function disableCommands(b) {
  createB.disabled = b;
  createT.disabled = b;
  joinB.disabled = b;
  gomassListGame.disabled = b;
  deckB.disabled = b;
}
function loadNewGame() {
  gameName = 'DEFAULT';
  myTurn = false;
  creator = false;
  createT.value = '';
  endTurnB.hide(true);
  resetAllBoards();
}
console.log('Finish index.js');
//-----------------------------------------------------------
</script>
</html>
